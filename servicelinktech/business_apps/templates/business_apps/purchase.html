{% extends "business_apps/master.html" %}
{% load multiply %}
{% block title %}
  SST | Purchase List
{% endblock %}

{% block header %}
Purchase List
{% endblock %}

{% block breadcrumbs %}
{% url 'slt:business' as url %}
{% url 'slt:purchase' as urls %}
<div style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='currentColor'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
  <ul style="display: flex; flex-wrap: wrap; margin-bottom: 0; padding-left: 0;">
    <li class="breadcrumb-item"><a href="{{url}}">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page"> Purchase</li>
  </ul>
</div>
{% endblock %}
    
{% block content %}
<div class="main-content">
  <div class="content">    
    <nav class="navbar navbar-expand">
      <div class="container-fluid">
        <div class="navbar-nav me-auto mb-2 mb-lg-0" style="align-items: center;">
          <span style="font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Purchase Order</span>
          <a class="nav-link" href="{% url 'slt:purchase_new' %}">New Purchase</a>
        </div>
        <div>
          <a class="nav-link" href="{% url 'slt:report_purchase_daily' %}" target="_blank">Print</a>
        
        </div>
      </div>
    </nav>
    <hr style="margin: .0rem 0rem 1rem 0rem;
    color: inherit;
    background-color: currentColor;
    border: 0;
    opacity: .75;"> 
    
    <div class="main-content">
      <div style=" gap: 1rem;" class="content row">
        <div class="content col-sm-6">      
            <div style="flex: 50%;">
                <h5 style="color: wheat; background-color: #6f00ff; padding: .5rem; border: 1px solid wheat; margin: -20px 20px 10px 20px; text-align: center;border-radius: 1.8rem;">Purc. Todays</h5>
            </div>              
            <div style="flex: 50%;">
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Order :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_order}}</span></div></div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Item :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_items}}</span></div> </div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Qty :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_items_qty}}</span></div> </div>
                <hr>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Amount :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_amount|floatformat:2}}</span></div> </div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Discount :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_discount|floatformat:2}}</span></div> </div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Due :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_due|floatformat:2}}</span></div> </div>
            </div>
        </div>
          <div class="content col-sm-6" >     
              <div style="flex: 50%;">
                  <h5 style="color: wheat; background-color: #700375; padding: .5rem; border: 1px solid wheat; margin: -20px 20px 10px 20px; text-align: center;border-radius: 1.8rem;">Purc. Payment</h5>
              </div>         
              <div style="flex: 50%;">
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Payment :</span> </div><div style="flex: 40%; text-align: right;"><span>{{cash_payments|floatformat:2}}</span></div></div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Due Payment :</span> </div><div style="flex: 40%; text-align: right;"><span>{{due_payments|floatformat:2}}</span></div> </div>
                  <hr>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Total Payment:</span> </div><div style="flex: 40%; text-align: right;"><span>{{cash_payments|addition:due_payments|floatformat:2}}</span></div> </div> 
                  <hr>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Due Order:</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_due_order}}</span></div> </div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Due Amount:</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_due_amt|floatformat:2}}</span></div> </div>
              
              </div> 
          </div>
          <div class="content col-sm-6">               
              <div style="flex: 50%;">
                  <h5 style="color: wheat; background-color: #8c4e06; padding: .5rem; border: 1px solid wheat; margin: -20px 20px 10px 20px; text-align: center;border-radius: 1.8rem;">Purc. Return</h5>
              </div>              
              <div style="flex: 50%;">
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Order :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_order}}</span></div></div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Item :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_items}}</span></div> </div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Qty :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_items_qty}}</span></div> </div>
                  <hr>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Amount :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_amount|floatformat:2}}</span></div> </div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Discount :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_discount|floatformat:2}}</span></div> </div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Due :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_due|floatformat:2}}</span></div> </div>
              </div>
          </div>
          <div class="content col-sm-6">               
              <div style="flex: 50%;">
                  <h5 style="color: wheat; background-color: #3a5b00; padding: .5rem; border: 1px solid wheat; margin: -20px 20px 10px 20px; text-align: center;border-radius: 1.8rem;">Purc. Cancel</h5>
              </div>              
              <div style="flex: 50%;">
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Order :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_order}}</span></div></div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Item :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_items}}</span></div> </div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Qty :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_items_qty}}</span></div> </div>
                  <hr>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Amount :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_amount|floatformat:2}}</span></div> </div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Discount :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_discount|floatformat:2}}</span></div> </div>
                  <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-weight: 700;"><div style="flex: 60%; text-align: right;"><span>Due :</span> </div><div style="flex: 40%; text-align: right;"><span>{{total_purchase_due|floatformat:2}}</span></div> </div>
              </div>
          </div>
      </div>
    </div>
    <div class="content d-flex" style="gap: 1rem;">
      <div style="flex: 70%;">
        
        <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
          <div>
            <span style="font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Purchase Order</span>
          </div>
          <div>
            <a class="nav-link" href="{% url 'slt:purchase' %}">Order List</a>
          </div>
        </div> 
      <table>
          <thead>
              <tr>
                  <th>Order ID</th>
                  <th>Supplier Name</th>
                  <th>Create Time</th>
                  <th>Order Amount</th>
                  <th>Order Discount</th>
                  <th>Order Due</th>
                  <th>Total Items</th>
                  <th>Create By</th>
                  <th>Edit</th>
                  <th>Print</th>
              </tr>
          </thead>
          <tbody>
              {% for order in purchase_order_today %}
              <tr>
                  <td>{{ order.id }}</td>
                  <td>{{ order.supplier_id__supplier_name }}</td>
                  <td>{{ order.porder_create_time|date:'Y-m-d h:i A' }}</td>
                  <td>{{ order.porder_total }}</td>
                  <td>{{ order.porder_discount }}</td>                  
                  <td style="color: rgb(110, 3, 3); font-weight: 600;">{{ order.porder_due }}</td>
                  <td>{{ order.total_items }}</td>
                  <td>{{ order.porder_create_by__username }}</td>
                  <td>
                    <a href="{% url 'slt:purchase_update' order.id %}">Edit</a>
                  </td>
                  <td>
                    <a href="{% url 'slt:purchase_invoice' order.id %}" target="_blank">View</a>
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>

      </div>
      <div style="flex: 30%;">
        <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
          <div>
            <span style="font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Purchase Item</span>
          </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Item ID</th>
                    <th>Item Name</th>
                    <th>Quantity</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for item in purchase_summary_today %}
                <tr>
                    <td>{{ item.item_id__id }}</td>
                    <td>{{ item.item_id__item_name }}</td>
                    <td>{{ item.total_purchased_quantity }}</td>
                    <td>{{ item.total_purchased_amount }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

      </div>
      
    </div>
    <br>
    <div class="content d-flex" style="gap: 1rem;"> 
      <div style="flex: 50%;">  
        <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
          <div>
            <span style="color: rgb(110, 3, 3); font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Purchase Due</span>
          </div>
          <div>
            <a class="nav-link" href="{% url 'slt:purchase' %}">Due List</a>
          </div>
        </div>          
          {% include "business_apps/purchase_order_due_list.html" %}
        <hr/> 
      </div> 
      <div style="flex: 50%;"> 
        <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
          <div>
            <span style="font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Payment List</span>
          </div>
          <div>
            <a class="nav-link" href="{% url 'slt:purchase' %}">Payment List</a>
          </div>
        </div>
          {% include "business_apps/purchase_payment_list.html" %}
        <hr/>

      </div> 
    </div>
    <br>
    <div class="content d-flex" style="gap: 1rem;"> 
      <div style="flex: 50%;">  
        <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
          <div>
            <span style="color: rgb(110, 3, 3); font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Order Return</span>
          </div>
          <div>
            <a class="nav-link" href="{% url 'slt:purchase' %}">Return List</a>
          </div>
        </div>          
          {% include "business_apps/purchase_order_due_list.html" %}
        <hr/> 
      </div> 
      <div style="flex: 50%;"> 
        <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
          <div>
            <span style="font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Order Cancel</span>
          </div>
          <div>
            <a class="nav-link" href="{% url 'slt:purchase' %}">Cancel List</a>
          </div>
        </div>
          {% include "business_apps/purchase_payment_list.html" %}
        <hr/>

      </div> 
    </div>
  </div>  
</div>
<div class="main-content">
  <div class="content"> 
    <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
      <div>
        <span style="font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Purchase List</span>
      </div>
      <div>              
        <!-- Filter form -->
        <form id="filter-form" method="get">
          {{ filterset.form.porder_status }}
        </form>
      </div>
      <div>
        <select id="filter-select" onchange="filterPayments()">
          <option value="all" {% if filter == 'all' %}selected{% endif %}>All</option>
          <option selected value="today" {% if filter == 'today' %}selected{% endif %}>Today's Payments</option>
          <option value="yesterday" {% if filter == 'yesterday' %}selected{% endif %}>Yesterday's Payments</option>
          <option value="this_month" {% if filter == 'this_month' %}selected{% endif %}>This Month's Payments</option>
          <option value="last_month" {% if filter == 'last_month' %}selected{% endif %}>Last Month's Payments</option>
        </select>
      </div>
      <div>             
        <input type="text" id="searchInput" style="background-image: url('/static/business_apps/icons/searchicon.png');background-repeat: no-repeat; background-position: 6px 10px;padding-left: 25px;"onkeyup="searchTable()" placeholder="Search for names...">
      </div>
    </div> 
    <!-- Paginated list -->
    <div id="list-container">
      {% include "business_apps/purchase_order_list.html" %}
    </div>
    <hr/>  
    <div class="content">
      <!-- Pagination controls -->
      <div class="pagination">
          <span class="step-links">
              {% if page_obj.has_previous %}
                  <a href="?page=1">&laquo; first</a>
                  <a href="?page={{ page_obj.previous_page_number }}">previous</a>
              {% endif %}
  
              <span class="current">
                  Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
              </span>
  
              {% if page_obj.has_next %}
                  <a href="?page={{ page_obj.next_page_number }}">next</a>
                  <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
              {% endif %}
          </span>
      </div>
    </div>
  </div>

</div>
<script>
  // Handle filter change
  $('#filter-form select, #filter-form input').on('change', function() {
      submitForm();
  });

  // Handle pagination click
  $(document).on('click', '.pagination-link', function(e) {
      e.preventDefault();
      const page = $(this).data('page');
      submitForm(page);
  });

  function submitForm(page = 1) {
      const form = $('#filter-form');
      const formData = form.serializeArray();
      formData.push({name: 'page', value: page});

      $.ajax({
          url: form.attr('action'),
          data: $.param(formData),
          success: function(data) {
              $('#list-container').html($(data).find('#list-container').html());
              $('.pagination').html($(data).find('.pagination').html());
          }
      });
  }
</script>
<script>
  function filterPayments() {
      var filter = document.getElementById("filter-select").value;
      window.location.href = "?filter=" + filter;
  }
</script>
{% endblock %}