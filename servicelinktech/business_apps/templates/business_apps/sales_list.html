{% extends "business_apps/master.html" %}

{% block title %}
  SST | Purchase List
{% endblock %}

{% block header %}
Purchase List
{% endblock %}

{% block breadcrumbs %}
{% url 'slt:business' as url %}
{% url 'slt:sales' as urls %}
<div style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='currentColor'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
  <ul style="display: flex; flex-wrap: wrap; margin-bottom: 0; padding-left: 0;">
    <li class="breadcrumb-item"><a href="{{url}}">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page"> Sales</li>
  </ul>
</div>
{% endblock %}
    
{% block content %}
<div class="main-content">
  <div class="content">    
    <nav class="navbar navbar-expand">
      <div class="container-fluid">
        <div class="navbar-nav me-auto mb-2 mb-lg-0" style="align-items: center;">
          <span style="font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Sales Order</span>
          <a class="nav-link" href="{% url 'slt:sales_new' %}">New Sales</a>
        </div>
        <div class="btn-group" style="gap: 2rem;align-items: center;">
          <div>              
            <!-- Filter form -->
            <form id="filter-form" method="get">
              {{ filterset.form.porder_status }}
            </form>
          </div>
          <div class="d-flex">             
            <input type="text" id="searchInput" style="background-image: url('/static/business_apps/icons/searchicon.png');background-repeat: no-repeat; background-position: 6px 10px;padding-left: 25px;"onkeyup="searchTable()" placeholder="Search for names...">
          </div>
        </div>
      </div>
    </nav>
    <hr style="margin: .0rem 0rem 1rem 0rem;
    color: inherit;
    background-color: currentColor;
    border: 0;
    opacity: .75;">   <div class="main-content">
    <div style=" gap: 1rem;" class="content row">
      <div class="content col-sm-6" >     
          <div style="flex: 50%;">
              <h5 style="color: wheat; background-color: #700375; padding: .5rem; border: 1px solid wheat; margin: -20px 20px 10px 20px; text-align: center;border-radius: 1.8rem;">Sales Summary</h5>
          </div>         
          <div style="flex: 50%;">
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Order :</span> </div><div style="flex: 50%;"><span>{{total_sales_orders}}</span></div></div>
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Item :</span> </div><div style="flex: 50%;"><span>{{total_sales_items}}</span></div> </div>
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Qty :</span> </div><div style="flex: 50%;"><span>{{total_sales_items_qty}}</span></div> </div>
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Amount :</span> </div><div style="flex: 50%;"><span>{{total_sales_amount|floatformat:2}}</span></div> </div>
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Due :</span> </div><div style="flex: 50%;"><span>{{total_sales_due|floatformat:2}}</span></div> </div>
          </div> 
      </div>
      <div class="content col-sm-6">      
          <div style="flex: 50%;">
              <h5 style="color: wheat; background-color: #6f00ff; padding: .5rem; border: 1px solid wheat; margin: -20px 20px 10px 20px; text-align: center;border-radius: 1.8rem;">Sales Todays</h5>
          </div>              
          <div style="flex: 50%;">
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Order :</span> </div><div style="flex: 50%;"><span>{{total_purchase_orders}}</span></div></div>
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Item :</span> </div><div style="flex: 50%;"><span>{{total_purchase_items}}</span></div> </div>
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Qty :</span> </div><div style="flex: 50%;"><span>{{total_purchase_items_qty}}</span></div> </div>
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Amount :</span> </div><div style="flex: 50%;"><span>{{total_purchase_amount|floatformat:2}}</span></div> </div>
              <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Due :</span> </div><div style="flex: 50%;"><span>{{total_purchase_due|floatformat:2}}</span></div> </div>
          </div>
      </div>
        <div class="content col-sm-6">               
            <div style="flex: 50%;">
                <h5 style="color: wheat; background-color: #8c4e06; padding: .5rem; border: 1px solid wheat; margin: -20px 20px 10px 20px; text-align: center;border-radius: 1.8rem;">Sales Return</h5>
            </div>         
            <div style="flex: 50%;">
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Order :</span> </div><div style="flex: 50%;"><span>{{total_sales_orders}}</span></div></div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Item :</span> </div><div style="flex: 50%;"><span>{{total_sales_items}}</span></div> </div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Qty :</span> </div><div style="flex: 50%;"><span>{{total_sales_items_qty}}</span></div> </div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Amount :</span> </div><div style="flex: 50%;"><span>{{total_sales_amount|floatformat:2}}</span></div> </div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Due :</span> </div><div style="flex: 50%;"><span>{{total_sales_due|floatformat:2}}</span></div> </div>
            </div> 
        </div>
        <div class="content col-sm-6">               
            <div style="flex: 50%;">
                <h5 style="color: wheat; background-color: #3a5b00; padding: .5rem; border: 1px solid wheat; margin: -20px 20px 10px 20px; text-align: center;border-radius: 1.8rem;">Sales Cancel</h5>
            </div>        
            <div style="flex: 50%;">
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Order :</span> </div><div style="flex: 50%;"><span>{{total_sales_orders}}</span></div></div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Item :</span> </div><div style="flex: 50%;"><span>{{total_sales_items}}</span></div> </div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Qty :</span> </div><div style="flex: 50%;"><span>{{total_sales_items_qty}}</span></div> </div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Amount :</span> </div><div style="flex: 50%;"><span>{{total_sales_amount|floatformat:2}}</span></div> </div>
                <div style="display: flex ; align-items: center; justify-content: center; gap: 1rem; font-size: 1.2em; font-weight: 700;"><div style="flex: 50%; text-align: right;"><span>Due :</span> </div><div style="flex: 50%;"><span>{{total_sales_due|floatformat:2}}</span></div> </div>
            </div> 
        </div>
    </div>
  </div>
    <br>
    <div class="content">   
      <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
        <div>
          <span style="font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Sales List</span>
        </div>
        <div>             
          <input type="text" id="searchInput" style="background-image: url('/static/business_apps/icons/searchicon.png');background-repeat: no-repeat; background-position: 6px 10px;padding-left: 25px;"onkeyup="searchTable()" placeholder="Search for names...">
        </div>
      </div> 
      <!-- Paginated list -->
      <div id="list-container">
        {% include "business_apps/sales_order_list.html" %}
      </div>
      <hr/> 
      <div class="content">
        <!-- Pagination controls -->
        <div class="pagination">
            <span class="step-links">
                {% if page_obj.has_previous %}
                    <a href="?page=1">&laquo; first</a>
                    <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                {% endif %}
  
                <span class="current">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                </span>
  
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}">next</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
                {% endif %}
            </span>
        </div>
      </div>
    </div>
  </div>  
</div>

<div class="main-content">
  <div class="content">    
    <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
      <div>
        <span style="color: rgb(110, 3, 3); font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Sales Due</span>
      </div>
      <div>             
        <input type="text" id="searchInput" style="background-image: url('/static/business_apps/icons/searchicon.png');background-repeat: no-repeat; background-position: 6px 10px;padding-left: 25px;"onkeyup="searchTable()" placeholder="Search for names...">
      </div>
    </div>          
      {% include "business_apps/sales_order_due_list.html" %}
    <hr/>
  </div>  
  <div class="content">    
    <div style="display: flex;align-items: center;justify-content: space-between;padding-bottom: 1rem;">      
      <div>
        <span style="font-size: 1.3rem; font-weight: bolder; margin-right: 2rem;">Payment List</span>
      </div>
      <div>             
        <input type="text" id="searchInput" style="background-image: url('/static/business_apps/icons/searchicon.png');background-repeat: no-repeat; background-position: 6px 10px;padding-left: 25px;"onkeyup="searchTable()" placeholder="Search for names...">
      </div>
    </div>
      {% include "business_apps/sales_payment_list.html" %}
    <hr/>


  </div>
</div>
<script>
  // Handle filter c    hange
  $('#filter-form select, #filter-form input').on('change', function() {
      submitForm();
  });

  // Handle pagination click
  $(document).on('click', '.pagination-link', function(e) {
      e.preventDefault();
      const page = $(this).data('page');
      submitForm(page);
  });

  function submitForm(page = 1) {
      const form = $('#filter-form');
      const formData = form.serializeArray();
      formData.push({name: 'page', value: page});

      $.ajax({
          url: form.attr('action'),
          data: $.param(formData),
          success: function(data) {
              $('#list-container').html($(data).find('#list-container').html());
              $('.pagination').html($(data).find('.pagination').html());
          }
      });
  }
</script>
{% endblock %}